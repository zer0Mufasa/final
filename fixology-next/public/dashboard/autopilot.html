<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Autopilot | Fixology Dashboard</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîß</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --border-color: rgba(255, 255, 255, 0.08);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      --accent-purple: #a78bfa;
      --accent-cyan: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --gradient-primary: linear-gradient(135deg, #a78bfa 0%, #06b6d4 100%);
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
    
    .dashboard { display: flex; min-height: 100vh; }
    
    .sidebar {
      width: 260px; background: var(--bg-secondary); border-right: 1px solid var(--border-color);
      padding: 1.5rem; position: fixed; height: 100vh; overflow-y: auto;
    }
    .logo { display: flex; align-items: center; gap: 0.75rem; font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; font-weight: 700; color: var(--text-primary); text-decoration: none; margin-bottom: 2rem; }
    .logo-icon { width: 40px; height: 40px; background: var(--gradient-primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
    
    .nav-section { margin-bottom: 1.5rem; }
    .nav-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.75rem; padding: 0 0.75rem; }
    .nav-link { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 10px; color: var(--text-secondary); text-decoration: none; transition: all 0.2s; margin-bottom: 0.25rem; }
    .nav-link:hover { background: var(--bg-card); color: var(--text-primary); }
    .nav-link.active { background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(6, 182, 212, 0.15)); color: var(--accent-purple); border: 1px solid rgba(167, 139, 250, 0.2); }
    
    .main-content { flex: 1; margin-left: 260px; padding: 2rem; }
    
    .page-header { margin-bottom: 2rem; }
    .page-title { font-family: 'Space Grotesk', sans-serif; font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem; }
    .page-subtitle { color: var(--text-secondary); }
    .ai-badge { background: var(--gradient-primary); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    
    .autopilot-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    
    .autopilot-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 1.5rem; transition: all 0.3s; }
    .autopilot-card:hover { border-color: rgba(167, 139, 250, 0.3); transform: translateY(-2px); }
    .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .card-icon { width: 48px; height: 48px; background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(6, 182, 212, 0.2)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
    .card-title { font-family: 'Space Grotesk', sans-serif; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem; }
    .card-description { color: var(--text-secondary); font-size: 0.9375rem; line-height: 1.6; margin-bottom: 1.5rem; }
    
    .toggle-switch { position: relative; width: 50px; height: 26px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 26px; transition: 0.4s; }
    .toggle-slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background: var(--text-muted); border-radius: 50%; transition: 0.4s; }
    input:checked + .toggle-slider { background: var(--gradient-primary); border-color: transparent; }
    input:checked + .toggle-slider:before { transform: translateX(22px); background: white; }
    
    .btn { padding: 0.75rem 1.25rem; font-size: 0.9375rem; font-weight: 600; border: none; border-radius: 10px; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; }
    .btn-primary { background: var(--gradient-primary); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(167, 139, 250, 0.3); }
    .btn-secondary { background: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-primary); }
    
    .generation-output { background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 10px; padding: 1rem; margin-top: 1rem; font-family: monospace; font-size: 0.875rem; color: var(--text-secondary); white-space: pre-wrap; max-height: 200px; overflow-y: auto; display: none; }
    .generation-output.visible { display: block; }
    
    .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 0.5rem; }
    .status-active { background: var(--success); box-shadow: 0 0 8px var(--success); }
    .status-inactive { background: var(--text-muted); }
    
    .stats-row { display: flex; gap: 1rem; margin-top: 1rem; }
    .mini-stat { background: var(--bg-card); padding: 0.75rem 1rem; border-radius: 8px; flex: 1; text-align: center; }
    .mini-stat-value { font-family: 'Space Grotesk', sans-serif; font-size: 1.25rem; font-weight: 700; color: var(--accent-purple); }
    .mini-stat-label { font-size: 0.75rem; color: var(--text-muted); }
    
    .pro-badge { background: linear-gradient(135deg, #f59e0b, #ef4444); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 700; margin-left: 0.5rem; }
    
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <a href="../index.html" class="logo"><span class="logo-icon">üîß</span><span>Fixology</span></a>
      
      <div class="nav-section">
        <div class="nav-label">Main</div>
        <a href="repairs.html" class="nav-link">üìã Repairs</a>
        <a href="customers.html" class="nav-link">üë• Customers</a>
        <a href="inventory.html" class="nav-link">üì¶ Inventory</a>
        <a href="invoices.html" class="nav-link">üí∞ Invoices</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-label">Tools</div>
        <a href="imei.html" class="nav-link">üîç IMEI Lookup</a>
        <a href="diagnostics.html" class="nav-link">ü©∫ Diagnostics</a>
        <a href="autopilot.html" class="nav-link active">ü§ñ AI Autopilot</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-label">Business</div>
        <a href="websites.html" class="nav-link">üåê Website</a>
        <a href="auto-reply.html" class="nav-link">üí¨ Auto Reply</a>
        <a href="settings.html" class="nav-link">‚öôÔ∏è Settings</a>
      </div>
    </aside>

    <main class="main-content">
      <div class="page-header">
        <h1 class="page-title">ü§ñ AI Autopilot <span class="ai-badge">BETA</span></h1>
        <p class="page-subtitle">Let AI handle repetitive tasks automatically</p>
      </div>

      <div class="autopilot-grid">
        <!-- Auto Price Generation -->
        <div class="autopilot-card">
          <div class="card-header">
            <div class="card-icon">üí∞</div>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-pricing" onchange="toggleFeature('pricing')">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <h3 class="card-title">Auto Price Generator</h3>
          <p class="card-description">AI automatically suggests competitive repair prices based on your location, market rates, and part costs.</p>
          <button class="btn btn-primary" onclick="generatePricing()">‚ú® Generate Prices</button>
          <div class="generation-output" id="output-pricing"></div>
          <div class="stats-row">
            <div class="mini-stat">
              <div class="mini-stat-value" id="stat-prices-generated">0</div>
              <div class="mini-stat-label">Generated</div>
            </div>
            <div class="mini-stat">
              <div class="mini-stat-value" id="stat-prices-applied">0</div>
              <div class="mini-stat-label">Applied</div>
            </div>
          </div>
        </div>

        <!-- Auto Reply -->
        <div class="autopilot-card">
          <div class="card-header">
            <div class="card-icon">üí¨</div>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-replies" onchange="toggleFeature('replies')">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <h3 class="card-title">Smart Auto-Reply</h3>
          <p class="card-description">Automatically respond to customer inquiries with personalized, context-aware messages.</p>
          <button class="btn btn-primary" onclick="generateReply()">‚ú® Preview Reply</button>
          <div class="generation-output" id="output-replies"></div>
          <div class="stats-row">
            <div class="mini-stat">
              <div class="mini-stat-value" id="stat-replies-sent">0</div>
              <div class="mini-stat-label">Sent</div>
            </div>
            <div class="mini-stat">
              <div class="mini-stat-value" id="stat-replies-saved">0</div>
              <div class="mini-stat-label">Hours Saved</div>
            </div>
          </div>
        </div>

        <!-- Website Content -->
        <div class="autopilot-card">
          <div class="card-header">
            <div class="card-icon">üåê</div>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-website" onchange="toggleFeature('website')">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <h3 class="card-title">Website Content AI</h3>
          <p class="card-description">Generate professional About Us, Services, and FAQ sections for your repair shop website.</p>
          <button class="btn btn-primary" onclick="generateWebsiteContent()">‚ú® Generate Content</button>
          <div class="generation-output" id="output-website"></div>
        </div>

        <!-- Invoice Drafts -->
        <div class="autopilot-card">
          <div class="card-header">
            <div class="card-icon">üìÑ</div>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-invoices" onchange="toggleFeature('invoices')">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <h3 class="card-title">Invoice Drafting <span class="pro-badge">PRO</span></h3>
          <p class="card-description">AI creates professional invoices based on completed repairs with itemized breakdowns.</p>
          <button class="btn btn-primary" onclick="generateInvoice()">‚ú® Draft Invoice</button>
          <div class="generation-output" id="output-invoices"></div>
        </div>

        <!-- Upsell Suggestions -->
        <div class="autopilot-card">
          <div class="card-header">
            <div class="card-icon">üìà</div>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-upsells" onchange="toggleFeature('upsells')">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <h3 class="card-title">Upsell Suggestions <span class="pro-badge">PRO</span></h3>
          <p class="card-description">Smart suggestions for accessories and add-on services to increase average ticket value.</p>
          <button class="btn btn-primary" onclick="generateUpsells()">‚ú® Get Suggestions</button>
          <div class="generation-output" id="output-upsells"></div>
        </div>

        <!-- Diagnostic Summary -->
        <div class="autopilot-card">
          <div class="card-header">
            <div class="card-icon">ü©∫</div>
            <label class="toggle-switch">
              <input type="checkbox" id="toggle-diagnostics" onchange="toggleFeature('diagnostics')">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <h3 class="card-title">Diagnostic Summaries</h3>
          <p class="card-description">Convert technical diagnostics into customer-friendly explanations and repair recommendations.</p>
          <button class="btn btn-primary" onclick="generateDiagnosticSummary()">‚ú® Summarize</button>
          <div class="generation-output" id="output-diagnostics"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const API_BASE = 'https://final-bice-phi.vercel.app';
    const token = localStorage.getItem('fixology_shop_token') || localStorage.getItem('fixology_token');

    if (!token) {
      window.location.href = '../shop-login.html';
    }

    function toggleFeature(feature) {
      const toggle = document.getElementById(`toggle-${feature}`);
      console.log(`${feature} autopilot ${toggle.checked ? 'enabled' : 'disabled'}`);
      // Save preference to backend
    }

    async function callAutopilot(type, context = {}) {
      const outputEl = document.getElementById(`output-${type}`);
      outputEl.textContent = 'Generating...';
      outputEl.classList.add('visible');

      try {
        const response = await fetch(`${API_BASE}/api/autopilot/generate`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ type, context })
        });

        const data = await response.json();
        
        if (data.success) {
          outputEl.textContent = data.content || data.result || JSON.stringify(data, null, 2);
        } else {
          outputEl.textContent = 'Error: ' + (data.error || 'Generation failed');
        }
      } catch (err) {
        outputEl.textContent = 'Error: ' + err.message;
      }
    }

    function generatePricing() {
      callAutopilot('pricing', { 
        device: 'iPhone 14 Pro', 
        repairs: ['screen', 'battery', 'charging port'] 
      });
    }

    function generateReply() {
      callAutopilot('replies', { 
        customerMessage: 'Hi, how much to fix a cracked screen on my iPhone 13?',
        customerName: 'John'
      });
    }

    function generateWebsiteContent() {
      callAutopilot('website', { 
        section: 'about',
        shopName: 'Mobile Repair Pro'
      });
    }

    function generateInvoice() {
      callAutopilot('invoices', { 
        customer: 'Jane Smith',
        device: 'Samsung Galaxy S23',
        repairs: [
          { name: 'Screen Replacement', price: 199 },
          { name: 'Battery Replacement', price: 49 }
        ]
      });
    }

    function generateUpsells() {
      callAutopilot('upsells', { 
        device: 'iPhone 14',
        currentRepair: 'Screen Replacement'
      });
    }

    function generateDiagnosticSummary() {
      callAutopilot('diagnostics', { 
        device: 'iPhone 12',
        issues: ['Battery draining fast', 'Camera not focusing', 'Speaker crackling']
      });
    }
  </script>
</body>
</html>

