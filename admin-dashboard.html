<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Founder Dashboard | Fixology Admin</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”§</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --border-color: rgba(255, 255, 255, 0.08);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      --accent-purple: #a78bfa;
      --accent-cyan: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gradient-primary: linear-gradient(135deg, #a78bfa 0%, #06b6d4 100%);
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
    
    .admin-layout { display: flex; min-height: 100vh; }
    
    .sidebar {
      width: 260px; background: var(--bg-secondary); border-right: 1px solid var(--border-color);
      padding: 1.5rem; position: fixed; height: 100vh; overflow-y: auto;
    }
    .logo { display: flex; align-items: center; gap: 0.75rem; font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; font-weight: 700; color: var(--text-primary); text-decoration: none; margin-bottom: 0.5rem; }
    .logo-icon { width: 40px; height: 40px; background: var(--gradient-primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
    .admin-badge { display: inline-flex; background: linear-gradient(135deg, #f59e0b, #ef4444); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 2rem; }
    
    .nav-section { margin-bottom: 1.5rem; }
    .nav-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.75rem; padding: 0 0.75rem; }
    .nav-link { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 10px; color: var(--text-secondary); text-decoration: none; transition: all 0.2s; margin-bottom: 0.25rem; }
    .nav-link:hover { background: var(--bg-card); color: var(--text-primary); }
    .nav-link.active { background: linear-gradient(135deg, rgba(167, 139, 250, 0.15), rgba(6, 182, 212, 0.15)); color: var(--accent-purple); border: 1px solid rgba(167, 139, 250, 0.2); }
    
    .main-content { flex: 1; margin-left: 260px; padding: 2rem; }
    
    .page-header { margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; }
    .page-title { font-family: 'Space Grotesk', sans-serif; font-size: 2rem; font-weight: 700; }
    .page-subtitle { color: var(--text-secondary); margin-top: 0.25rem; }
    .refresh-btn { background: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-primary); padding: 0.625rem 1.25rem; border-radius: 10px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; }
    .refresh-btn:hover { border-color: var(--accent-purple); }
    
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
    .stat-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 1.5rem; }
    .stat-card.highlight { background: linear-gradient(135deg, rgba(167, 139, 250, 0.1), rgba(6, 182, 212, 0.1)); border-color: rgba(167, 139, 250, 0.3); }
    .stat-icon { font-size: 1.5rem; margin-bottom: 0.75rem; }
    .stat-label { font-size: 0.8125rem; color: var(--text-muted); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em; }
    .stat-value { font-family: 'Space Grotesk', sans-serif; font-size: 2.5rem; font-weight: 700; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .stat-change { font-size: 0.8125rem; color: var(--success); margin-top: 0.5rem; display: flex; align-items: center; gap: 0.25rem; }
    
    .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }
    .chart-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 16px; padding: 1.5rem; }
    .chart-title { font-family: 'Space Grotesk', sans-serif; font-size: 1.125rem; font-weight: 600; margin-bottom: 1.25rem; display: flex; align-items: center; gap: 0.5rem; }
    
    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 0.875rem; text-align: left; border-bottom: 1px solid var(--border-color); }
    .data-table th { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); font-weight: 600; letter-spacing: 0.05em; }
    .data-table td { font-size: 0.9375rem; }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover td { background: var(--bg-card); }
    
    .revenue-item { display: flex; justify-content: space-between; align-items: center; padding: 0.875rem 0; border-bottom: 1px solid var(--border-color); }
    .revenue-item:last-child { border-bottom: none; }
    .revenue-label { color: var(--text-secondary); display: flex; align-items: center; gap: 0.5rem; }
    .revenue-value { font-weight: 600; font-family: 'Space Grotesk', sans-serif; }
    .revenue-value.total { font-size: 1.5rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    .badge { padding: 0.25rem 0.625rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
    .badge.success { background: rgba(16, 185, 129, 0.15); color: var(--success); }
    .badge.warning { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    
    .loading { text-align: center; padding: 4rem; color: var(--text-muted); }
    .error { text-align: center; padding: 4rem; }
    .error h3 { color: var(--danger); margin-bottom: 0.5rem; }
    
    @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .charts-grid { grid-template-columns: 1fr; } }
    @media (max-width: 768px) { .sidebar { display: none; } .main-content { margin-left: 0; } .stats-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="admin-layout">
    <aside class="sidebar">
      <a href="index.html" class="logo"><span class="logo-icon">ğŸ”§</span><span>Fixology</span></a>
      <div class="admin-badge">ğŸ”’ Founder Access</div>
      
      <div class="nav-section">
        <div class="nav-label">Dashboard</div>
        <a href="admin-dashboard.html" class="nav-link active">ğŸ“Š Overview</a>
        <a href="admin/users.html" class="nav-link">ğŸ‘¥ Users</a>
        <a href="admin/shops.html" class="nav-link">ğŸª Shops</a>
        <a href="admin/imei-logs.html" class="nav-link">ğŸ” IMEI Logs</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-label">Management</div>
        <a href="admin/billing.html" class="nav-link">ğŸ’³ Billing</a>
        <a href="admin/content.html" class="nav-link">ğŸ“ Content</a>
        <a href="admin/support.html" class="nav-link">ğŸ§ Support</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-label">System</div>
        <a href="admin/api-keys.html" class="nav-link">ğŸ”‘ API Keys</a>
        <a href="admin/settings.html" class="nav-link">âš™ï¸ Settings</a>
        <a href="admin/status.html" class="nav-link">ğŸŸ¢ Status</a>
      </div>
      
      <div class="nav-section">
        <div class="nav-label">Quick Links</div>
        <a href="index.html" class="nav-link">ğŸ  Main Site</a>
        <a href="dashboard/index.html" class="nav-link">ğŸ“‹ Shop Dashboard</a>
        <a href="#" class="nav-link" onclick="logout()">ğŸšª Logout</a>
      </div>
    </aside>

    <main class="main-content">
      <div class="page-header">
        <div>
          <h1 class="page-title">ğŸ“Š Founder Dashboard</h1>
          <p class="page-subtitle">Real-time analytics and platform metrics</p>
        </div>
        <button class="refresh-btn" onclick="loadStats()">â†» Refresh Data</button>
      </div>

      <div id="loading" class="loading">
        <p>ğŸ”„ Loading dashboard data...</p>
      </div>
      
      <div id="error" class="error" style="display: none;"></div>

      <div id="dashboard-content" style="display: none;">
        <div class="stats-grid">
          <div class="stat-card highlight">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-label">Total Users</div>
            <div class="stat-value" id="stat-users">0</div>
            <div class="stat-change" id="stat-users-change">+0 today</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸª</div>
            <div class="stat-label">Total Shops</div>
            <div class="stat-value" id="stat-shops">0</div>
            <div class="stat-change" id="stat-shops-change">+0 today</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ğŸ”</div>
            <div class="stat-label">IMEI Checks</div>
            <div class="stat-value" id="stat-imei">0</div>
            <div class="stat-change" id="stat-imei-change">+0 today</div>
          </div>
          <div class="stat-card highlight">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-label">Monthly Revenue</div>
            <div class="stat-value" id="stat-revenue">$0</div>
            <div class="stat-change">Estimated MRR</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-card">
            <h3 class="chart-title">ğŸ“± Top Diagnosed Devices</h3>
            <table class="data-table">
              <thead>
                <tr><th>Device</th><th>Count</th><th>Share</th></tr>
              </thead>
              <tbody id="top-devices">
                <tr><td colspan="3" style="text-align: center; color: var(--text-muted);">No data yet</td></tr>
              </tbody>
            </table>
          </div>

          <div class="chart-card">
            <h3 class="chart-title">ğŸ’° Revenue by Plan</h3>
            <div id="revenue-breakdown">
              <div class="revenue-item">
                <span class="revenue-label">ğŸš€ Basic ($29/mo)</span>
                <span class="revenue-value" id="rev-basic">$0</span>
              </div>
              <div class="revenue-item">
                <span class="revenue-label">ğŸ’ Pro ($79/mo)</span>
                <span class="revenue-value" id="rev-pro">$0</span>
              </div>
              <div class="revenue-item">
                <span class="revenue-label">ğŸ¢ Enterprise ($199/mo)</span>
                <span class="revenue-value" id="rev-enterprise">$0</span>
              </div>
              <div class="revenue-item" style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
                <span class="revenue-label"><strong>Total MRR</strong></span>
                <span class="revenue-value total" id="rev-total">$0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="chart-card">
            <h3 class="chart-title">ğŸ“ Top Cities</h3>
            <table class="data-table">
              <thead>
                <tr><th>City</th><th>Users</th></tr>
              </thead>
              <tbody id="top-cities">
                <tr><td colspan="2" style="text-align: center; color: var(--text-muted);">No data yet</td></tr>
              </tbody>
            </table>
          </div>

          <div class="chart-card">
            <h3 class="chart-title">ğŸ“Š Shop Subscriptions</h3>
            <div id="subscription-stats">
              <div class="revenue-item">
                <span class="revenue-label">â­ Free Tier</span>
                <span class="revenue-value" id="sub-free">0</span>
              </div>
              <div class="revenue-item">
                <span class="revenue-label">ğŸš€ Basic</span>
                <span class="revenue-value" id="sub-basic">0</span>
              </div>
              <div class="revenue-item">
                <span class="revenue-label">ğŸ’ Pro</span>
                <span class="revenue-value" id="sub-pro">0</span>
              </div>
              <div class="revenue-item">
                <span class="revenue-label">ğŸ¢ Enterprise</span>
                <span class="revenue-value" id="sub-enterprise">0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const API_BASE = 'https://final-bice-phi.vercel.app';
    const token = localStorage.getItem('fixology_token') || localStorage.getItem('fixology_shop_token');

    async function loadStats() {
      try {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('dashboard-content').style.display = 'none';
        document.getElementById('error').style.display = 'none';

        const response = await fetch(`${API_BASE}/api/admin/stats`, {
          headers: token ? { 'Authorization': `Bearer ${token}` } : {}
        });
        const data = await response.json();

        if (!data.success) {
          throw new Error(data.error || 'Failed to load stats');
        }

        document.getElementById('loading').style.display = 'none';
        document.getElementById('dashboard-content').style.display = 'block';

        // Populate stats
        document.getElementById('stat-users').textContent = data.overview?.totalUsers || 0;
        document.getElementById('stat-users-change').textContent = `+${data.users?.today || 0} today`;
        document.getElementById('stat-shops').textContent = data.overview?.totalShops || 0;
        document.getElementById('stat-shops-change').textContent = `+${data.shops?.today || 0} today`;
        document.getElementById('stat-imei').textContent = data.overview?.totalImeiChecks || 0;
        document.getElementById('stat-imei-change').textContent = `+${data.imei?.today || 0} today`;
        document.getElementById('stat-revenue').textContent = `$${data.revenue?.total || 0}`;

        // Revenue breakdown
        document.getElementById('rev-basic').textContent = `$${data.revenue?.basic || 0}`;
        document.getElementById('rev-pro').textContent = `$${data.revenue?.pro || 0}`;
        document.getElementById('rev-enterprise').textContent = `$${data.revenue?.enterprise || 0}`;
        document.getElementById('rev-total').textContent = `$${data.revenue?.total || 0}`;

        // Subscription stats
        const subs = data.shops?.subscriptions || {};
        document.getElementById('sub-free').textContent = subs.free || 0;
        document.getElementById('sub-basic').textContent = subs.basic || 0;
        document.getElementById('sub-pro').textContent = subs.pro || 0;
        document.getElementById('sub-enterprise').textContent = subs.enterprise || 0;

        // Top devices
        const devicesBody = document.getElementById('top-devices');
        const topDevices = data.diagnostics?.topDevices || [];
        if (topDevices.length > 0) {
          const total = topDevices.reduce((sum, d) => sum + d.count, 0);
          devicesBody.innerHTML = topDevices.slice(0, 5).map(d => `
            <tr>
              <td>${d.device}</td>
              <td>${d.count}</td>
              <td>${Math.round(d.count / total * 100)}%</td>
            </tr>
          `).join('');
        }

        // Top cities
        const citiesBody = document.getElementById('top-cities');
        const topCities = data.locations?.topCities || [];
        if (topCities.length > 0) {
          citiesBody.innerHTML = topCities.slice(0, 5).map(c => `
            <tr><td>${c.city}</td><td>${c.count}</td></tr>
          `).join('');
        }

      } catch (err) {
        console.error('Error loading stats:', err);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').innerHTML = `
          <h3>âš ï¸ Could not load data</h3>
          <p style="color: var(--text-muted); margin-top: 0.5rem;">${err.message}</p>
          <button onclick="loadStats()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--accent-purple); border: none; border-radius: 8px; color: white; cursor: pointer;">Try Again</button>
        `;
      }
    }

    function logout() {
      localStorage.removeItem('fixology_token');
      localStorage.removeItem('fixology_shop_token');
      window.location.href = 'index.html';
    }

    // Load on page load
    loadStats();
  </script>
</body>
</html>
