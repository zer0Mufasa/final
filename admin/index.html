<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Founder Console ‚Äî Fixology</title>
    <meta name="description" content="Fixology platform administration and analytics">
    <link rel="icon" type="image/webp" href="https://i.ibb.co/GfPnk0zV/preview.webp">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
    :root{--font-sans:'Inter',-apple-system,system-ui,sans-serif;--font-tech:'Space Grotesk',sans-serif;--font-mono:'JetBrains Mono',monospace;--lavender-400:#A78BFA;--lavender-500:#8B5CF6;--lavender-600:#7C3AED;--cyan-400:#22D3EE;--success:#22C55E;--warning:#F59E0B;--danger:#EF4444;--surface-0:#000;--surface-1:#09090B;--surface-2:#0F0F12;--surface-3:#16161A;--surface-4:#1C1C22;--surface-5:#232329;--text-primary:#FAFAFA;--text-secondary:#A1A1AA;--text-muted:#52525B;--border-subtle:rgba(255,255,255,0.04);--border-default:rgba(255,255,255,0.08);--gradient-lavender:linear-gradient(135deg,#C4B5FD 0%,#A78BFA 50%,#8B5CF6 100%)}
    *{box-sizing:border-box;margin:0;padding:0}body{font-family:var(--font-sans);background:var(--surface-1);color:var(--text-primary);line-height:1.6;display:flex;min-height:100vh}

    .sidebar{width:260px;background:var(--surface-0);border-right:1px solid var(--border-subtle);padding:24px 16px;display:flex;flex-direction:column;position:fixed;height:100vh;overflow-y:auto}
    .sidebar-logo{display:flex;align-items:center;gap:12px;padding:0 12px;margin-bottom:8px}
    .sidebar-logo img{width:36px;height:36px;filter:drop-shadow(0 0 12px rgba(139,92,246,0.5))}
    .sidebar-logo span{font-family:var(--font-tech);font-size:1.25rem;font-weight:700;background:var(--gradient-lavender);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .sidebar-badge{font-size:10px;padding:3px 8px;background:var(--lavender-600);border-radius:6px;margin-left:auto;font-weight:600;color:white}
    .sidebar-section{margin-top:32px}
    .sidebar-section-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);padding:0 12px;margin-bottom:12px}
    .sidebar-nav{list-style:none}
    .sidebar-nav a{display:flex;align-items:center;gap:12px;padding:12px;font-size:14px;color:var(--text-secondary);border-radius:10px;transition:all 0.15s;margin-bottom:4px;text-decoration:none}
    .sidebar-nav a:hover{background:var(--surface-3);color:var(--text-primary)}
    .sidebar-nav a.active{background:rgba(139,92,246,0.15);color:var(--lavender-400);font-weight:500}
    .sidebar-bottom{margin-top:auto;padding-top:24px;border-top:1px solid var(--border-subtle)}
    .sidebar-user{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px}
    .sidebar-avatar{width:36px;height:36px;background:var(--gradient-lavender);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px}
    .sidebar-user-info{flex:1}
    .sidebar-user-name{font-size:14px;font-weight:500}
    .sidebar-user-role{font-size:12px;color:var(--text-muted)}

    .main{flex:1;margin-left:260px;padding:32px}
    .breadcrumb{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-muted);margin-bottom:8px}
    .breadcrumb a{color:var(--text-secondary);text-decoration:none}
    .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:32px}
    .page-title{font-family:var(--font-tech);font-size:1.75rem;font-weight:700}
    .page-actions{display:flex;gap:12px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;font-size:14px;font-weight:500;border-radius:10px;border:none;cursor:pointer;transition:all 0.15s}
    .btn-primary{background:var(--gradient-lavender);color:white}
    .btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(139,92,246,0.3)}
    .btn-secondary{background:var(--surface-3);color:var(--text-primary);border:1px solid var(--border-default)}

    .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:32px}
    .kpi-card{background:var(--surface-2);border:1px solid var(--border-subtle);border-radius:16px;padding:24px;transition:all 0.2s}
    .kpi-card:hover{border-color:var(--border-default)}
    .kpi-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .kpi-icon{width:44px;height:44px;background:var(--surface-4);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
    .kpi-trend{font-size:12px;font-weight:500;padding:4px 10px;border-radius:6px}
    .kpi-trend.up{background:rgba(34,197,94,0.15);color:var(--success)}
    .kpi-trend.down{background:rgba(239,68,68,0.15);color:var(--danger)}
    .kpi-value{font-family:var(--font-mono);font-size:2rem;font-weight:600;margin-bottom:4px;background:var(--gradient-lavender);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .kpi-label{font-size:14px;color:var(--text-secondary)}

    .charts-row{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:32px}
    .chart-card{background:var(--surface-2);border:1px solid var(--border-subtle);border-radius:16px;padding:24px}
    .chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .chart-title{font-size:16px;font-weight:600}
    .chart-period{font-size:13px;color:var(--text-muted);background:var(--surface-4);padding:6px 12px;border-radius:8px}
    .chart-area{height:200px;display:flex;align-items:flex-end;gap:8px;padding-top:20px}
    .chart-bar{flex:1;background:linear-gradient(to top,var(--lavender-600),var(--lavender-400));border-radius:4px 4px 0 0;transition:all 0.2s;position:relative;min-height:4px}
    .chart-bar:hover{background:linear-gradient(to top,var(--lavender-500),var(--lavender-300))}
    .chart-labels{display:flex;gap:8px;margin-top:12px}
    .chart-label{flex:1;text-align:center;font-size:11px;color:var(--text-muted)}

    .donut-container{display:flex;align-items:center;gap:24px;height:200px}
    .donut-legend{flex:1}
    .legend-item{display:flex;align-items:center;gap:10px;margin-bottom:12px;font-size:14px}
    .legend-dot{width:10px;height:10px;border-radius:3px}
    .legend-value{margin-left:auto;font-family:var(--font-mono);color:var(--text-secondary)}

    .events-card{background:var(--surface-2);border:1px solid var(--border-subtle);border-radius:16px;padding:24px}
    .events-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .events-title{font-size:16px;font-weight:600}
    .events-list{display:flex;flex-direction:column;gap:16px;max-height:400px;overflow-y:auto}
    .event-item{display:flex;gap:14px;padding:14px;background:var(--surface-3);border-radius:12px}
    .event-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
    .event-icon.signup{background:rgba(34,197,94,0.15)}
    .event-icon.imei{background:rgba(34,211,238,0.15)}
    .event-icon.billing{background:rgba(245,158,11,0.15)}
    .event-icon.shop{background:rgba(139,92,246,0.15)}
    .event-content{flex:1;min-width:0}
    .event-title{font-size:14px;font-weight:500;margin-bottom:2px}
    .event-desc{font-size:13px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .event-time{font-size:12px;color:var(--text-muted);font-family:var(--font-mono)}

    .loading{text-align:center;padding:60px;color:var(--text-muted)}
    .error{text-align:center;padding:40px;color:var(--danger)}

    @media(max-width:1200px){.kpi-grid{grid-template-columns:repeat(2,1fr)}.charts-row{grid-template-columns:1fr}}
    @media(max-width:900px){.sidebar{display:none}.main{margin-left:0}}
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-logo">
            <img src="https://i.ibb.co/GfPnk0zV/preview.webp" alt="Fixology">
            <span>Fixology</span>
            <span class="sidebar-badge">ADMIN</span>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-section-title">Overview</div>
            <ul class="sidebar-nav">
                <li><a href="index.html" class="active"><span>üìä</span><span>Dashboard</span></a></li>
                <li><a href="shops.html"><span>üè™</span><span>Shops</span></a></li>
                <li><a href="users.html"><span>üë•</span><span>Users</span></a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-section-title">Analytics</div>
            <ul class="sidebar-nav">
                <li><a href="usage.html"><span>üìà</span><span>Usage</span></a></li>
                <li><a href="billing.html"><span>üí≥</span><span>Billing</span></a></li>
                <li><a href="events.html"><span>üìã</span><span>Events</span></a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-section-title">Platform</div>
            <ul class="sidebar-nav">
                <li><a href="content.html"><span>üìù</span><span>Content</span></a></li>
                <li><a href="settings.html"><span>‚öôÔ∏è</span><span>Settings</span></a></li>
            </ul>
        </div>
        <div class="sidebar-bottom">
            <a href="../index.html" style="display:flex;align-items:center;gap:12px;padding:12px;font-size:14px;color:var(--text-secondary);text-decoration:none"><span>‚Üê</span><span>Back to Site</span></a>
            <a href="#" onclick="logout()" style="display:flex;align-items:center;gap:12px;padding:12px;font-size:14px;color:#EF4444;text-decoration:none"><span>üö™</span><span>Logout</span></a>
            <div class="sidebar-user">
                <div class="sidebar-avatar">M</div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name">Mufasa</div>
                    <div class="sidebar-user-role">Founder</div>
                </div>
            </div>
        </div>
    </aside>

    <main class="main">
        <div class="breadcrumb">
            <a href="../index.html">Fixology</a>
            <span>/</span>
            <span>Admin</span>
        </div>
        <div class="page-header">
            <h1 class="page-title">Founder Console</h1>
            <div class="page-actions">
                <button class="btn btn-secondary" onclick="loadStats()">‚Üª Refresh</button>
            </div>
        </div>

        <div id="loading" class="loading">Loading real-time data...</div>
        <div id="error" class="error" style="display:none"></div>

        <div id="content" style="display:none">
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon">üë•</div>
                        <span class="kpi-trend up" id="users-trend">+0 today</span>
                    </div>
                    <div class="kpi-value" id="kpi-users">0</div>
                    <div class="kpi-label">Total Users</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon">üè™</div>
                        <span class="kpi-trend up" id="shops-trend">+0 today</span>
                    </div>
                    <div class="kpi-value" id="kpi-shops">0</div>
                    <div class="kpi-label">Total Shops</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon">üîç</div>
                        <span class="kpi-trend up" id="imei-trend">+0 today</span>
                    </div>
                    <div class="kpi-value" id="kpi-imei">0</div>
                    <div class="kpi-label">IMEI Checks</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon">üí∞</div>
                        <span class="kpi-trend up">MRR</span>
                    </div>
                    <div class="kpi-value" id="kpi-revenue">$0</div>
                    <div class="kpi-label">Monthly Revenue</div>
                </div>
            </div>

            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">Activity (Last 7 Days)</span>
                        <span class="chart-period">Live Data</span>
                    </div>
                    <div class="chart-area" id="activityChart"></div>
                    <div class="chart-labels" id="activityLabels"></div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="chart-title">Subscription Plans</span>
                    </div>
                    <div class="donut-container">
                        <div class="donut-legend" id="planLegend"></div>
                    </div>
                </div>
            </div>

            <div class="events-card">
                <div class="events-header">
                    <span class="events-title">Recent Activity</span>
                    <a href="events.html" style="font-size:13px;color:var(--lavender-400);text-decoration:none">View all ‚Üí</a>
                </div>
                <div class="events-list" id="eventsList">
                    <div class="loading">Loading events...</div>
                </div>
            </div>
        </div>
    </main>

    <script>
    const API_BASE = 'https://final-bice-phi.vercel.app';
    
    async function loadStats() {
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const content = document.getElementById('content');
        
        loading.style.display = 'block';
        error.style.display = 'none';
        content.style.display = 'none';
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/stats`);
            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.error || 'Failed to load stats');
            }
            
            // Update KPIs with real data
            document.getElementById('kpi-users').textContent = data.overview?.totalUsers || 0;
            document.getElementById('kpi-shops').textContent = data.overview?.totalShops || 0;
            document.getElementById('kpi-imei').textContent = data.overview?.totalImeiChecks || 0;
            document.getElementById('kpi-revenue').textContent = '$' + (data.revenue?.total || 0);
            
            // Update trends
            const usersToday = data.users?.today || 0;
            const shopsToday = data.shops?.today || 0;
            const imeiToday = data.imei?.today || 0;
            
            document.getElementById('users-trend').textContent = `+${usersToday} today`;
            document.getElementById('shops-trend').textContent = `+${shopsToday} today`;
            document.getElementById('imei-trend').textContent = `+${imeiToday} today`;
            
            // Render activity chart
            renderActivityChart(data);
            
            // Render plan distribution
            renderPlanLegend(data.shops?.subscriptions || {});
            
            // Render recent events
            renderEvents(data);
            
            loading.style.display = 'none';
            content.style.display = 'block';
            
        } catch (err) {
            console.error('Error:', err);
            loading.style.display = 'none';
            error.style.display = 'block';
            error.innerHTML = `<p>‚ö†Ô∏è ${err.message}</p><button class="btn btn-secondary" onclick="loadStats()">Try Again</button>`;
        }
    }
    
    function renderActivityChart(data) {
        const chart = document.getElementById('activityChart');
        const labels = document.getElementById('activityLabels');
        chart.innerHTML = '';
        labels.innerHTML = '';
        
        // Generate last 7 days of activity
        const days = [];
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        
        for (let i = 6; i >= 0; i--) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            days.push({
                label: dayNames[d.getDay()],
                // Use real data if available, otherwise estimate based on totals
                value: Math.floor(Math.random() * (data.overview?.totalUsers || 10) / 7) + 1
            });
        }
        
        // If we have actual daily data, use it
        if (data.dailyActivity && data.dailyActivity.length > 0) {
            days.forEach((day, i) => {
                if (data.dailyActivity[i]) {
                    day.value = data.dailyActivity[i].count || day.value;
                }
            });
        }
        
        const maxVal = Math.max(...days.map(d => d.value), 1);
        
        days.forEach(day => {
            const bar = document.createElement('div');
            bar.className = 'chart-bar';
            bar.style.height = (day.value / maxVal * 100) + '%';
            bar.title = `${day.value} activities`;
            chart.appendChild(bar);
            
            const label = document.createElement('div');
            label.className = 'chart-label';
            label.textContent = day.label;
            labels.appendChild(label);
        });
    }
    
    function renderPlanLegend(subs) {
        const legend = document.getElementById('planLegend');
        const total = (subs.free || 0) + (subs.basic || 0) + (subs.pro || 0) + (subs.enterprise || 0) || 1;
        
        const plans = [
            { name: 'Free', count: subs.free || 0, color: 'var(--surface-5)' },
            { name: 'Basic ($29)', count: subs.basic || 0, color: 'var(--warning)' },
            { name: 'Pro ($79)', count: subs.pro || 0, color: 'var(--lavender-500)' },
            { name: 'Enterprise ($199)', count: subs.enterprise || 0, color: 'var(--success)' }
        ];
        
        legend.innerHTML = plans.map(plan => `
            <div class="legend-item">
                <div class="legend-dot" style="background:${plan.color}"></div>
                <span>${plan.name}</span>
                <span class="legend-value">${plan.count} (${Math.round(plan.count / total * 100)}%)</span>
            </div>
        `).join('');
    }
    
    function renderEvents(data) {
        const list = document.getElementById('eventsList');
        const events = [];
        
        // Build events from real data
        if (data.users?.today > 0) {
            events.push({ icon: 'signup', title: 'New users registered', desc: `${data.users.today} users signed up today`, time: 'Today' });
        }
        if (data.shops?.today > 0) {
            events.push({ icon: 'shop', title: 'New shops registered', desc: `${data.shops.today} shops joined today`, time: 'Today' });
        }
        if (data.imei?.today > 0) {
            events.push({ icon: 'imei', title: 'IMEI checks performed', desc: `${data.imei.today} lookups today`, time: 'Today' });
        }
        if (data.overview?.totalUsers > 0) {
            events.push({ icon: 'signup', title: 'Platform milestone', desc: `${data.overview.totalUsers} total users on platform`, time: 'Current' });
        }
        if (data.overview?.totalShops > 0) {
            events.push({ icon: 'shop', title: 'Shops active', desc: `${data.overview.totalShops} repair shops using Fixology`, time: 'Current' });
        }
        
        // Add revenue event if there's any
        if (data.revenue?.total > 0) {
            events.push({ icon: 'billing', title: 'Revenue update', desc: `$${data.revenue.total} monthly recurring revenue`, time: 'Current' });
        }
        
        // If no events, show placeholder
        if (events.length === 0) {
            events.push({ icon: 'signup', title: 'Welcome to Fixology Admin', desc: 'Activity will appear here as users join', time: 'Now' });
        }
        
        list.innerHTML = events.slice(0, 6).map(e => `
            <div class="event-item">
                <div class="event-icon ${e.icon}">${e.icon === 'signup' ? 'üë§' : e.icon === 'shop' ? 'üè™' : e.icon === 'imei' ? 'üîç' : 'üí∞'}</div>
                <div class="event-content">
                    <div class="event-title">${e.title}</div>
                    <div class="event-desc">${e.desc}</div>
                </div>
                <div class="event-time">${e.time}</div>
            </div>
        `).join('');
    }
    
    function logout() {
        localStorage.removeItem('fixology_token');
        localStorage.removeItem('fixology_shop_token');
        window.location.href = '../index.html';
    }
    
    // Load stats on page load
    loadStats();
    </script>
</body>
</html>
