<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events ‚Äî Fixology Admin</title>
    <link rel="icon" type="image/webp" href="https://i.ibb.co/GfPnk0zV/preview.webp">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
    :root{--font-sans:'Inter',-apple-system,system-ui,sans-serif;--font-tech:'Space Grotesk',sans-serif;--font-mono:'JetBrains Mono',monospace;--lavender-400:#A78BFA;--lavender-500:#8B5CF6;--lavender-600:#7C3AED;--cyan-400:#22D3EE;--success:#22C55E;--warning:#F59E0B;--danger:#EF4444;--surface-0:#000;--surface-1:#09090B;--surface-2:#0F0F12;--surface-3:#16161A;--surface-4:#1C1C22;--text-primary:#FAFAFA;--text-secondary:#A1A1AA;--text-muted:#52525B;--border-subtle:rgba(255,255,255,0.04);--border-default:rgba(255,255,255,0.08);--gradient-lavender:linear-gradient(135deg,#C4B5FD 0%,#A78BFA 50%,#8B5CF6 100%)}
    *{box-sizing:border-box;margin:0;padding:0}body{font-family:var(--font-sans);background:var(--surface-1);color:var(--text-primary);line-height:1.6;display:flex;min-height:100vh}
    .sidebar{width:260px;background:var(--surface-0);border-right:1px solid var(--border-subtle);padding:24px 16px;display:flex;flex-direction:column;position:fixed;height:100vh}
    .sidebar-logo{display:flex;align-items:center;gap:12px;padding:0 12px}
    .sidebar-logo img{width:36px;height:36px;filter:drop-shadow(0 0 12px rgba(139,92,246,0.5))}
    .sidebar-logo span{font-family:var(--font-tech);font-size:1.25rem;font-weight:700;background:var(--gradient-lavender);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .sidebar-badge{font-size:10px;padding:3px 8px;background:var(--lavender-600);border-radius:6px;margin-left:auto;font-weight:600;color:white}
    .sidebar-section{margin-top:32px}
    .sidebar-section-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted);padding:0 12px;margin-bottom:12px}
    .sidebar-nav{list-style:none}
    .sidebar-nav a{display:flex;align-items:center;gap:12px;padding:12px;font-size:14px;color:var(--text-secondary);border-radius:10px;transition:all 0.15s;margin-bottom:4px;text-decoration:none}
    .sidebar-nav a:hover{background:var(--surface-3);color:var(--text-primary)}
    .sidebar-nav a.active{background:rgba(139,92,246,0.15);color:var(--lavender-400);font-weight:500}
    .sidebar-bottom{margin-top:auto;padding-top:24px;border-top:1px solid var(--border-subtle)}
    .sidebar-user{display:flex;align-items:center;gap:12px;padding:12px}
    .sidebar-avatar{width:36px;height:36px;background:var(--gradient-lavender);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:600}
    .sidebar-user-name{font-size:14px;font-weight:500}
    .sidebar-user-role{font-size:12px;color:var(--text-muted)}
    .main{flex:1;margin-left:260px;padding:32px}
    .breadcrumb{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-muted);margin-bottom:8px}
    .breadcrumb a{color:var(--text-secondary);text-decoration:none}
    .page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    .page-title{font-family:var(--font-tech);font-size:1.75rem;font-weight:700}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;font-size:14px;font-weight:500;border-radius:10px;border:none;cursor:pointer}
    .btn-secondary{background:var(--surface-3);color:var(--text-primary);border:1px solid var(--border-default)}
    .events-list{display:flex;flex-direction:column;gap:12px}
    .event-card{display:flex;gap:16px;padding:20px;background:var(--surface-2);border:1px solid var(--border-subtle);border-radius:14px;transition:all 0.15s}
    .event-card:hover{border-color:var(--border-default)}
    .event-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
    .event-icon.signup{background:rgba(34,197,94,0.15)}
    .event-icon.shop{background:rgba(139,92,246,0.15)}
    .event-icon.imei{background:rgba(34,211,238,0.15)}
    .event-icon.user{background:rgba(167,139,250,0.15)}
    .event-content{flex:1}
    .event-header{display:flex;align-items:center;gap:10px;margin-bottom:4px}
    .event-type{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;padding:3px 8px;background:var(--surface-4);border-radius:4px;color:var(--text-muted)}
    .event-title{font-size:15px;font-weight:500}
    .event-desc{font-size:14px;color:var(--text-secondary);margin-top:4px}
    .event-meta{display:flex;align-items:center;gap:16px;margin-top:10px;font-size:13px;color:var(--text-muted)}
    .mono{font-family:var(--font-mono)}
    .loading{text-align:center;padding:60px;color:var(--text-muted)}
    .empty-state{text-align:center;padding:80px 40px;background:var(--surface-2);border:1px solid var(--border-subtle);border-radius:16px}
    .empty-icon{font-size:48px;margin-bottom:16px}
    .empty-title{font-family:var(--font-tech);font-size:1.25rem;margin-bottom:8px}
    .empty-desc{color:var(--text-muted);font-size:14px}
    @media(max-width:900px){.sidebar{display:none}.main{margin-left:0}}
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-logo"><img src="https://i.ibb.co/GfPnk0zV/preview.webp" alt="Fixology"><span>Fixology</span><span class="sidebar-badge">ADMIN</span></div>
        <div class="sidebar-section"><div class="sidebar-section-title">Overview</div><ul class="sidebar-nav"><li><a href="index.html"><span>üìä</span><span>Dashboard</span></a></li><li><a href="shops.html"><span>üè™</span><span>Shops</span></a></li><li><a href="users.html"><span>üë•</span><span>Users</span></a></li></ul></div>
        <div class="sidebar-section"><div class="sidebar-section-title">Analytics</div><ul class="sidebar-nav"><li><a href="usage.html"><span>üìà</span><span>Usage</span></a></li><li><a href="billing.html"><span>üí≥</span><span>Billing</span></a></li><li><a href="events.html" class="active"><span>üìã</span><span>Events</span></a></li></ul></div>
        <div class="sidebar-section"><div class="sidebar-section-title">Platform</div><ul class="sidebar-nav"><li><a href="content.html"><span>üìù</span><span>Content</span></a></li><li><a href="settings.html"><span>‚öôÔ∏è</span><span>Settings</span></a></li></ul></div>
        <div class="sidebar-bottom">
            <a href="../index.html" style="display:flex;align-items:center;gap:12px;padding:12px;font-size:14px;color:var(--text-secondary);text-decoration:none"><span>‚Üê</span><span>Back to Site</span></a>
            <a href="#" onclick="logout()" style="display:flex;align-items:center;gap:12px;padding:12px;font-size:14px;color:#EF4444;text-decoration:none"><span>üö™</span><span>Logout</span></a>
            <div class="sidebar-user"><div class="sidebar-avatar">M</div><div><div class="sidebar-user-name">Mufasa</div><div class="sidebar-user-role">Founder</div></div></div>
        </div>
    </aside>
    <main class="main">
        <div class="breadcrumb"><a href="index.html">Admin</a><span>/</span><span>Events</span></div>
        <div class="page-header">
            <h1 class="page-title">Event Log</h1>
            <button class="btn btn-secondary" onclick="loadEvents()">‚Üª Refresh</button>
        </div>
        
        <div id="loading" class="loading">Loading events...</div>
        <div id="events-container" class="events-list" style="display:none"></div>
    </main>

    <script>
    const API_BASE = 'https://final-bice-phi.vercel.app';
    
    async function loadEvents() {
        const container = document.getElementById('events-container');
        const loading = document.getElementById('loading');
        
        loading.style.display = 'block';
        container.style.display = 'none';
        
        try {
            const response = await fetch(`${API_BASE}/api/admin/stats`);
            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.error || 'Failed to load');
            }
            
            const events = [];
            
            // Build events from real data
            // Add user signup events
            if (data.usersList && data.usersList.length > 0) {
                data.usersList.forEach(user => {
                    events.push({
                        type: 'user',
                        icon: 'üë§',
                        iconClass: 'user',
                        title: `User registered: ${user.name || user.email?.split('@')[0] || 'Unknown'}`,
                        desc: `New customer account created`,
                        time: user.createdAt,
                        email: user.email
                    });
                });
            }
            
            // Add shop signup events
            if (data.shopsList && data.shopsList.length > 0) {
                data.shopsList.forEach(shop => {
                    events.push({
                        type: 'shop',
                        icon: 'üè™',
                        iconClass: 'shop',
                        title: `Shop registered: ${shop.shopName || 'Unknown Shop'}`,
                        desc: `${shop.subscriptionPlan || 'Free'} plan${shop.city ? ' from ' + shop.city : ''}`,
                        time: shop.createdAt,
                        email: shop.email
                    });
                });
            }
            
            // Sort by date (newest first)
            events.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            loading.style.display = 'none';
            container.style.display = 'flex';
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div class="empty-title">No Events Yet</div>
                        <div class="empty-desc">Events will appear here as users register, shops sign up, and activity occurs on your platform.</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = events.map(event => `
                <div class="event-card">
                    <div class="event-icon ${event.iconClass}">${event.icon}</div>
                    <div class="event-content">
                        <div class="event-header"><span class="event-type">${event.type}</span></div>
                        <div class="event-title">${event.title}</div>
                        <div class="event-desc">${event.desc}</div>
                        <div class="event-meta">
                            <span class="mono">${formatDate(event.time)}</span>
                            ${event.email ? `<span>${event.email}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
        } catch (err) {
            console.error('Error:', err);
            loading.style.display = 'none';
            container.style.display = 'flex';
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <div class="empty-title">Could Not Load Events</div>
                    <div class="empty-desc">${err.message}</div>
                </div>
            `;
        }
    }
    
    function formatDate(dateStr) {
        if (!dateStr) return 'Unknown';
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            year: 'numeric',
            hour: 'numeric',
            minute: '2-digit'
        });
    }
    
    function logout() {
        localStorage.removeItem('fixology_token');
        localStorage.removeItem('fixology_shop_token');
        window.location.href = '../index.html';
    }
    
    loadEvents();
    </script>
</body>
</html>
